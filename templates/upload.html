<form method="POST" enctype="multipart/form-data" action="{% url 'upload-file' %}" id="uploadForm">
    {% csrf_token %}
    <div style="max-width: 400px; margin: 40px 0 0 0;">
        <div class="input-group mb-3">
            <input type="file" class="form-control" name="file" id="uploadArea" accept=".feather" required>
            <button type="submit" id="fileUploadButton" class="btn btn-primary">
                Upload
                <span class="spinner-border spinner-border-sm" id="spinner" style="display:none;"></span>
            </button>
        </div>
        <p id="statusMessage" style="font-size: 14px; color: gray;">Please upload a dataset file (e.g., Feather).</p>
    </div>
</form>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const uploadForm = document.getElementById('uploadForm');
    const spinner = document.getElementById('spinner');
    const statusMessage = document.getElementById('statusMessage');
    const fileUploadButton = document.getElementById('fileUploadButton');

    uploadArea.addEventListener('change', () => {
        if (uploadArea.files.length > 0) {
            statusMessage.textContent = `File selected: ${uploadArea.files[0].name}`;
            statusMessage.style.color = "gray";
        }
    });

    uploadForm.addEventListener('submit', (event) => {
        event.preventDefault();
        spinner.style.display = 'inline-block';
        fileUploadButton.disabled = true;

        fetch("{% url 'upload-file' %}", {
            method: "POST",
            body: new FormData(uploadForm),
        })
            .then(response => {
                spinner.style.display = 'none';
                fileUploadButton.disabled = false;
                statusMessage.textContent = response.ok
                    ? `File uploaded successfully!`
                    : "File upload failed!";
                statusMessage.style.color = response.ok ? "teal" : "red";
            })
            .catch(() => {
                spinner.style.display = 'none';
                fileUploadButton.disabled = false;
                statusMessage.textContent = "An error occurred!";
                statusMessage.style.color = "red";
            });
    });
</script>